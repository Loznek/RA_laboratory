var ne=Object.create;var E=Object.defineProperty,re=Object.defineProperties,ie=Object.getOwnPropertyDescriptor,oe=Object.getOwnPropertyDescriptors,se=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols,le=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var v=(e,n,o)=>n in e?E(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,d=(e,n)=>{for(var o in n||(n={}))$.call(n,o)&&v(e,o,n[o]);if(S)for(var o of S(n))K.call(n,o)&&v(e,o,n[o]);return e},f=(e,n)=>re(e,oe(n)),M=e=>E(e,"__esModule",{value:!0}),u=(e,n)=>E(e,"name",{value:n,configurable:!0});var O=(e,n)=>{var o={};for(var t in e)$.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&S)for(var t of S(e))n.indexOf(t)<0&&K.call(e,t)&&(o[t]=e[t]);return o};var pe=(e,n)=>{for(var o in n)E(e,o,{get:n[o],enumerable:!0})},z=(e,n,o,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of se(n))!$.call(e,r)&&(o||r!=="default")&&E(e,r,{get:()=>n[r],enumerable:!(t=ie(n,r))||t.enumerable});return e},P=(e,n)=>z(M(E(e!=null?ne(le(e)):{},"default",!n&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),ae=(e=>(n,o)=>e&&e.get(n)||(o=z(M({}),n,1),e&&e.set(n,o),o))(typeof WeakMap!="undefined"?new WeakMap:0);var qe={};pe(qe,{buildQuery:()=>ge,default:()=>Ie});var ee=P(require("lodash/merge")),te=P(require("ra-data-graphql"));var T=require("ra-core");var Q=require("graphql"),J=u(e=>e.kind===Q.TypeKind.NON_NULL||e.kind===Q.TypeKind.LIST?J(e.ofType):e,"getFinalType"),N=J;var x=require("graphql"),W=u(e=>e.kind===x.TypeKind.NON_NULL?W(e.ofType):e.kind===x.TypeKind.LIST,"isList"),L=W;var D=u(e=>(n,o,t,r)=>{let l=G(t,r,e);switch(o){case T.GET_LIST:return h(e)(n,o,l);case T.GET_MANY:return{filter:{ids:l.ids}};case T.GET_MANY_REFERENCE:{let s=h(e)(n,o,l);return s.filter=f(d({},s.filter),{[l.target]:l.id}),s}case T.GET_ONE:case T.DELETE:return{id:l.id};case T.CREATE:case T.UPDATE:return de(n,o,l,r)}},"default"),F=u((e,n)=>e.name==="Int"?parseInt(n,10):e.name==="Float"?parseFloat(n):n,"sanitizeValue"),ue=u((e,n)=>{let o=n.kind==="NON_NULL"?n.ofType:n;switch(`${o.kind}:${o.name}`){case"SCALAR:Int":return Number(e);case"SCALAR:String":return String(e);case"SCALAR:Boolean":return Boolean(e);default:return e}},"castType"),G=u((e,n,o)=>{let t={};return e&&(Object.keys(e).forEach(r=>{let l=e[r],s=null;if(!l){t[r]=l;return}if(n&&Array.isArray(n.args)&&(s=n.args.find(p=>p.name===r)),l instanceof File){t[r]=l;return}if(l instanceof Date){t[r]=l.toISOString();return}if(l instanceof Object&&!Array.isArray(l)&&s&&s.type.kind==="INPUT_OBJECT"){let p=o.types.find(a=>a.kind===s.type.kind&&a.name===s.type.name).inputFields;t[r]=G(l,{args:p},o);return}if(l instanceof Object&&!(l instanceof Date)&&!Array.isArray(l)){t[r]=G(l,n,o);return}if(!s){t[r]=l;return}t[r]=ue(l,s.type)}),t)},"prepareParams"),h=u(e=>(n,o,t)=>{let r={filter:{}};return t.filter&&(r.filter=Object.keys(t.filter).reduce((l,s)=>{var m,g;if(s==="ids")return f(d({},l),{ids:t.filter[s]});if(typeof t.filter[s]=="object"){let c=e.types.find(y=>y.name===`${n.type.name}Filter`);if((m=c==null?void 0:c.inputFields)==null?void 0:m.find(y=>y.name===`${s}_some`)){let y=Object.keys(t.filter[s]).reduce((_,R)=>f(d({},_),{[`${R}_in`]:t.filter[s][R]}),{});return f(d({},l),{[`${s}_some`]:y})}}let p=s.split(".");if(p.length>1){if(p[1]==="id"){let y=e.types.find(R=>R.name===`${n.type.name}Filter`);return((g=y==null?void 0:y.inputFields)==null?void 0:g.find(R=>R.name===`${p[0]}_some`))?f(d({},l),{[`${p[0]}_some`]:{id:t.filter[s]}}):f(d({},l),{[p[0]]:{id:t.filter[s]}})}let c=n.type.fields.find(y=>y.name===p[0]),I=N(c.type);return f(d({},l),{[s]:F(I,t.filter[s])})}let a=n.type.fields.find(c=>c.name===s);if(a){let c=N(a.type);return L(a.type)?f(d({},l),{[s]:Array.isArray(t.filter[s])?t.filter[s].map(y=>F(c,y)):F(c,[t.filter[s]])}):f(d({},l),{[s]:F(c,t.filter[s])})}return f(d({},l),{[s]:t.filter[s]})},{})),t.pagination&&(r.page=parseInt(t.pagination.page,10)-1,r.perPage=parseInt(t.pagination.perPage,10)),t.sort&&(r.sortField=t.sort.field,r.sortOrder=t.sort.order),r},"buildGetListVariables"),de=u((e,n,{id:o,data:t},r)=>Object.keys(t).reduce((l,s)=>Array.isArray(t[s])&&r.args.find(a=>a.name===`${s}Ids`)?f(d({},l),{[`${s}Ids`]:t[s].map(({id:a})=>a)}):typeof t[s]=="object"&&r.args.find(a=>a.name===`${s}Id`)?f(d({},l),{[`${s}Id`]:t[s].id}):f(d({},l),{[s]:t[s]}),{id:o}),"buildCreateUpdateVariables");var q=require("ra-core"),Z=require("ra-data-graphql"),U=require("graphql"),i=P(require("graphql-ast-types-browser"));var C=require("graphql"),H=u(e=>e.kind===C.TypeKind.LIST?H(e.ofType):e.kind===C.TypeKind.NON_NULL,"isRequired"),X=H;var V=u(e=>(n,o,t,r)=>{let I=r,{sortField:l,sortOrder:s}=I,p=O(I,["sortField","sortOrder"]),a=ce(t,r),m=k(t,r),g=k(t,p),c=B(e)(n.type.fields);return o===q.GET_LIST||o===q.GET_MANY||o===q.GET_MANY_REFERENCE?i.document([i.operationDefinition("query",i.selectionSet([i.field(i.name(t.name),i.name("items"),m,null,i.selectionSet(c)),i.field(i.name(`_${t.name}Meta`),i.name("total"),g,null,i.selectionSet([i.field(i.name("count"))]))]),i.name(t.name),a)]):o===q.DELETE?i.document([i.operationDefinition("mutation",i.selectionSet([i.field(i.name(t.name),i.name("data"),m,null,i.selectionSet(c))]),i.name(t.name),a)]):i.document([i.operationDefinition(Z.QUERY_TYPES.includes(o)?"query":"mutation",i.selectionSet([i.field(i.name(t.name),i.name("data"),m,null,i.selectionSet(c))]),i.name(t.name),a)])},"default"),B=u((e,n=[])=>o=>o.reduce((t,r)=>{let l=N(r.type);if(l.name.startsWith("_"))return t;if(l.kind!==U.TypeKind.OBJECT&&l.kind!==U.TypeKind.INTERFACE)return[...t,i.field(i.name(r.name))];if(e.resources.find(a=>a.type.name===l.name))return[...t,i.field(i.name(r.name),null,null,null,i.selectionSet([i.field(i.name("id"))]))];let p=e.types.find(a=>a.name===l.name);if(p&&!n.includes(p.name)){let a=p.possibleTypes||[];return[...t,i.field(i.name(r.name),null,null,null,i.selectionSet([...fe(e)(a),...B(e,[...n,p.name])(p.fields)]))]}return t},[]),"buildFields"),fe=u(e=>n=>n.reduce((o,t)=>{let r=N(t),l=e.types.find(s=>s.name===r.name);return[...o,i.inlineFragment(i.selectionSet(B(e)(l.fields)),i.namedType(i.name(r.name)))]},[]),"buildFragments"),k=u((e,n)=>{if(e.args.length===0)return[];let o=Object.keys(n).filter(r=>typeof n[r]!="undefined");return e.args.filter(r=>o.includes(r.name)).reduce((r,l)=>[...r,i.argument(i.name(l.name),i.variable(i.name(l.name)))],[])},"buildArgs"),ce=u((e,n)=>{if(e.args.length===0)return[];let o=Object.keys(n).filter(r=>typeof n[r]!="undefined");return e.args.filter(r=>o.includes(r.name)).reduce((r,l)=>[...r,i.variableDefinition(i.variable(i.name(l.name)),me(l))],[])},"buildApolloArgs"),me=u(e=>{let n=N(e.type),o=X(e.type);return L(e.type)?o?i.listType(i.nonNullType(i.namedType(i.name(n.name)))):i.listType(i.namedType(i.name(n.name))):o?i.nonNullType(i.namedType(i.name(n.name))):i.namedType(i.name(n.name))},"getArgType");var A=require("ra-core"),w=u(e=>(n,o,t)=>r=>{let l=r.data;return n===A.GET_LIST||n===A.GET_MANY||n===A.GET_MANY_REFERENCE?{data:r.data.items.map(j),total:r.data.total.count}:{data:j(l.data)}},"default"),j=u(e=>Object.keys(e).reduce((o,t)=>{if(t.startsWith("_"))return o;let r=e[t];return r==null?o:Array.isArray(r)?typeof r[0]=="object"&&r[0]!==null?f(d({},o),{[t]:r.map(j),[`${t}Ids`]:r.map(l=>l.id)}):f(d({},o),{[t]:r}):typeof r=="object"&&r!==null?f(d(d({},o),r&&r.id&&{[`${t}.id`]:r.id}),{[t]:r.__typename?j(r):r}):f(d({},o),{[t]:r})},{}),"sanitizeResource");var ye=u((e=D,n=V,o=w)=>t=>{let r=t.resources.map(s=>s.type.name);return u((s,p,a)=>{let m=t.resources.find(_=>_.type.name===p);if(!m)throw new Error(`Unknown resource ${p}. Make sure it has been declared on your server side schema. Known resources are ${r.join(", ")}`);let g=m[s];if(!g)throw new Error(`No query or mutation matching fetch type ${s} could be found for resource ${m.type.name}`);let c=e(t)(m,s,a,g),I=n(t)(m,s,g,c),y=o(t)(s,m,g);return{query:I,variables:c,parseResponse:y}},"buildQuery")},"buildQueryFactory"),Y=ye(D,V,w);var Te={buildQuery:Y},ge=Y,Ie=u(e=>(0,te.default)((0,ee.default)({},Te,e)).then(n=>f(d({},n),{deleteMany:(o,t)=>{let s=t,{ids:r}=s,l=O(s,["ids"]);return Promise.all(r.map(p=>n.delete(o,d({id:p,previousData:null},l)))).then(p=>({data:p.reduce((m,{data:g})=>[...m,g.id],[])}))},updateMany:(o,t)=>{let p=t,{ids:r,data:l}=p,s=O(p,["ids","data"]);return Promise.all(r.map(a=>n.update(o,d({id:a,data:l,previousData:null},s)))).then(a=>({data:a.reduce((g,{data:c})=>[...g,c.id],[])}))}})),"default");module.exports=ae(qe);0&&(module.exports={buildQuery});
//# sourceMappingURL=index.js.map