var ee=Object.create;var y=Object.defineProperty,te=Object.defineProperties,oe=Object.getOwnPropertyDescriptor,ne=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,ie=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var D=(e,t,o)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,c=(e,t)=>{for(var o in t||(t={}))g.call(t,o)&&D(e,o,t[o]);if(T)for(var o of T(t))k.call(t,o)&&D(e,o,t[o]);return e},f=(e,t)=>te(e,ne(t)),j=e=>y(e,"__esModule",{value:!0}),s=(e,t)=>y(e,"name",{value:t,configurable:!0});var E=(e,t)=>{var o={};for(var n in e)g.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&T)for(var n of T(e))t.indexOf(n)<0&&k.call(e,n)&&(o[n]=e[n]);return o};var se=(e,t)=>{for(var o in t)y(e,o,{get:t[o],enumerable:!0})},q=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of re(t))!g.call(e,i)&&(o||i!=="default")&&y(e,i,{get:()=>t[i],enumerable:!(n=oe(t,i))||n.enumerable});return e},b=(e,t)=>q(j(y(e!=null?ee(ie(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),ae=(e=>(t,o)=>e&&e.get(t)||(o=q(j({}),t,1),e&&e.set(t,o),o))(typeof WeakMap!="undefined"?new WeakMap:0);var Re={};se(Re,{ALL_TYPES:()=>Te,MUTATION_TYPES:()=>Oe,QUERY_TYPES:()=>Ee,default:()=>he,introspectSchema:()=>M,isResourceExcluded:()=>V,isResourceIncluded:()=>B});var W=b(require("lodash/merge")),H=b(require("lodash/get")),P=b(require("pluralize")),r=require("ra-core");var u=require("@apollo/client"),U=s(e=>{if(!e)return new u.ApolloClient({cache:new u.InMemoryCache().restore({})});let p=e,{cache:t=new u.InMemoryCache().restore({}),uri:o,link:n=o?new u.HttpLink({uri:o}):void 0}=p,i=E(p,["cache","uri","link"]);return new u.ApolloClient(c({link:n,cache:t},i))},"default");var a=require("ra-core"),_=[a.GET_LIST,a.GET_MANY,a.GET_MANY_REFERENCE,a.GET_ONE],v=[a.CREATE,a.UPDATE,a.DELETE,a.UPDATE_MANY,a.DELETE_MANY],I=_.concat(v);var F=require("graphql"),$=require("@apollo/client");var h,M=s(async(e,t)=>h||(h=pe(e,t),h),"introspectSchema"),pe=s(async(e,t)=>{let o=t.schema?t.schema:await ce(e),n=ue(o),i=le(o),p=ye(i,n,t);return{types:i,queries:n,resources:p,schema:o}},"runSchemaIntrospection"),ce=s(e=>e.query({fetchPolicy:"network-only",query:$.gql`
                ${(0,F.getIntrospectionQuery)()}
            `}).then(({data:{__schema:t}})=>t),"fetchSchema"),ue=s(e=>e.types.reduce((t,o)=>{var n,i;return o.name!==((n=e.queryType)==null?void 0:n.name)&&o.name!==((i=e.mutationType)==null?void 0:i.name)&&o.fields?t:[...t,...o.fields||[]]},[]),"getQueriesFromSchema"),le=s(e=>e.types.filter(t=>t.name!==(e.queryType&&e.queryType.name)&&t.name!==(e.mutationType&&e.mutationType.name)),"getTypesFromSchema"),ye=s((e,t,o)=>e.filter(i=>de(i,t,o)).map(i=>me(i,t,o)),"getResources"),de=s((e,t,o)=>B(e,o)?!0:V(e,o)?!1:Object.keys(o.operationNames).map(p=>o.operationNames[p](e)).some(p=>t.find(({name:l})=>l===p)),"isResource"),B=s((e,{include:t}={})=>Array.isArray(t)?t.includes(e.name):typeof t=="function"?t(e):!1,"isResourceIncluded"),V=s((e,{exclude:t}={})=>Array.isArray(t)?t.includes(e.name):typeof t=="function"?t(e):!1,"isResourceExcluded"),me=s((e,t,o)=>I.reduce((n,i)=>{let p=t.find(({name:l})=>o.operationNames[i]&&l===o.operationNames[i](e));return p?f(c({},n),{[i]:p}):n},{type:e}),"buildResource");var Ee=_,Oe=v,Te=I,fe={getList:r.GET_LIST,getMany:r.GET_MANY,getManyReference:r.GET_MANY_REFERENCE,getOne:r.GET_ONE,create:r.CREATE,delete:r.DELETE,deleteMany:r.DELETE_MANY,update:r.UPDATE,updateMany:r.UPDATE_MANY},Ie={resolveIntrospection:M,introspection:{operationNames:{[r.GET_LIST]:e=>`all${(0,P.default)(e.name)}`,[r.GET_ONE]:e=>`${e.name}`,[r.GET_MANY]:e=>`all${(0,P.default)(e.name)}`,[r.GET_MANY_REFERENCE]:e=>`all${(0,P.default)(e.name)}`,[r.CREATE]:e=>`create${e.name}`,[r.UPDATE]:e=>`update${e.name}`,[r.DELETE]:e=>`delete${e.name}`},exclude:void 0,include:void 0}},z=s((e,t,o)=>typeof e=="function"?e(o,t):e,"getOptions"),he=s(async e=>{let Y=(0,W.default)({},Ie,e),{client:t,clientOptions:o,introspection:n,resolveIntrospection:i,buildQuery:p,override:l={}}=Y,N=E(Y,["client","clientOptions","introspection","resolveIntrospection","buildQuery","override"]);l&&process.env.NODE_ENV==="production"&&console.warn("The override option is deprecated. You should instead wrap the buildQuery function provided by the dataProvider you use.");let A=t||U(o),w;return new Proxy(Ae,{get:(ge,R)=>{if(typeof R=="symbol"||R==="then")return;let d=fe[R];return async(m,Q)=>{n&&(w=await i(A,n));let x=p(w),L=(0,H.default)(l,`${m}.${d}`),G=L?c(c({},x(d,m,Q)),L(Q)):x(d,m,Q),{parseResponse:C}=G,O=E(G,["parseResponse"]);if(Pe(O.query)==="query"){let X=c(f(c({},O),{fetchPolicy:"network-only"}),z(N.query,d,m));return A.query(X).then(Z=>C(Z)).catch(J)}let K=c({mutation:O.query,variables:O.variables},z(N.mutation,d,m));return A.mutate(K).then(C).catch(J)}}})},"default"),J=s(e=>{var t,o;throw(e==null?void 0:e.networkError)?new r.HttpError((t=e==null?void 0:e.networkError)==null?void 0:t.message,(o=e==null?void 0:e.networkError)==null?void 0:o.statusCode):new r.HttpError(e.message,200,e)},"handleError"),Pe=s(e=>{if(e&&e.definitions&&e.definitions.length>0)return e.definitions[0].operation;throw new Error("Unable to determine the query operation")},"getQueryOperation"),Ae={create:()=>Promise.resolve({data:null}),delete:()=>Promise.resolve({data:null}),deleteMany:()=>Promise.resolve({data:[]}),getList:()=>Promise.resolve({data:[],total:0}),getMany:()=>Promise.resolve({data:[]}),getManyReference:()=>Promise.resolve({data:[],total:0}),getOne:()=>Promise.resolve({data:null}),update:()=>Promise.resolve({data:null}),updateMany:()=>Promise.resolve({data:[]})};module.exports=ae(Re);0&&(module.exports={ALL_TYPES,MUTATION_TYPES,QUERY_TYPES,introspectSchema,isResourceExcluded,isResourceIncluded});
//# sourceMappingURL=index.js.map